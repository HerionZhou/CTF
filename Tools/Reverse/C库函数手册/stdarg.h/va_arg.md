### va_arg   函数使用说明





| 文档版本 | 作者   | 修改日期   | 备注     |
| -------- | ------ | ---------- | -------- |
| V0.1     | 范东洋 | 2019.12.03 | 内容初填 |
|          |        |            |          |
|          |        |            |          |





#### 1.1. 函数原型

```c
#include <stdarg.h>
type va_arg( va_list ap, type );
```



#### 1.2. 功能描述

`va_arg` 展开为一个type类型表达式，这个表达式的类型和值跟调用的下一个参数的相同。 函数所作的就是根据 `ap` 指向的地址，和第二个参数所确定的类型，将这个参数的中的数据提取出来，作为返回值，同时让 `ap` 指向下一个参数。 



#### 1.3. 使用示例

```c
#include <stdio.h>
#include <stdarg.h>
#include <math.h>
 
double stddev(int count, ...) 
{
    double sum = 0;
    double sum_sq = 0;
    va_list args;
    va_start(args, count);
    for (int i = 0; i < count; ++i) 
    {
        double num = va_arg(args, double);
        sum += num;
        sum_sq += num*num;
    }
    va_end(args);
    return sqrt(sum_sq/count - (sum/count)*(sum/count));
}
 
int main(void) 
{
    printf("%f\n", stddev(4, 25.0, 27.3, 26.9, 25.7));
}
```

运行结果：

```
0.920258
```







#### 1.4. 参数说明

| 参数 | 说明                    |
| ---- | ----------------------- |
| ap   | `va_list` 类型实例。    |
| type | `ap` 中的下个可变参数。 |







#### 1.5. 函数返回值

第一次调用 `va_start` 之后，对 `va_arg` 的第一次调用返回的是parmN 指定的参数后面的参数值。后面的调用一次返回剩下的参数值。







#### 1.6. 使用注意事项

`va_arg` 的每一次调用都会修改 `ap`,这样后继参数的值就会依次返回。参数类型是指定的类型名字。使得指向指定类型的数据对象的指针的类型可以简单地通过在类型后面加一个后缀 `*` 来获得。如果实际不存在下一个参数，或者类型和实际存在的下一个参数（根据默认的参数提升规则来提升）的类型不兼容，那么这种行为未定义，除非： 一个类型是有符号整数类型，另一类型是对应的无符号整数类型，而且值可以被两类型一同表示或者 一个类型是指向 `void` 的指针，而另一个是指向字符类型的指针。





