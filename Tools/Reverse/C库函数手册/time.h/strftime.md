### 1. strftime  函数使用说明





| 文档版本 | 作者   | 修改日期   | 备注     |
| -------- | ------ | ---------- | -------- |
| V0.1     | 范东洋 | 2019.12.02 | 内容初填 |
|          |        |            |          |
|          |        |            |          |





#### 1.1. 函数原型

```c
#include <time.h>
size_t strftime( char *restrict str, size_t count, const char                   *restrict format, const struct tm *restrict                     time );
```



#### 1.2. 功能描述

按照格式字符串 `format` ，转换来自给定的日历时间 `time` 的日期和时间信息，为空终止多字节字符串 `str` 。最多写入 `count` 字节。 





#### 1.3. 使用示例

计算从月初开始经过的秒数。

```c

#include <stdio.h>
#include <time.h>
#include <locale.h>
 
int main(void)
{
    char buff[70];
    struct tm my_time = { .tm_year=112, // = 2012年
                          .tm_mon=9,    // = 10月
                          .tm_mday=9,   // = 9日
                          .tm_hour=8,   // = 8时
                          .tm_min=10,   // = 10分
                          .tm_sec=20    // = 20秒
    };
 
    if (strftime(buff, sizeof buff, "%A %c", &my_time)) {
        puts(buff);
    } else {
        puts("strftime failed");
    }
 
    setlocale(LC_TIME, "el_GR.utf8");
 
    if (strftime(buff, sizeof buff, "%A %c", &my_time)) {
        puts(buff);
    } else {
        puts("strftime failed");
    }
}

```

运行结果：

```
Sunday Sun Oct  9 08:10:20 2012
Κυριακή Κυρ 09 Οκτ 2012 08:10:20 πμ EST
```







#### 1.4. 参数说明

| 参数  |         含义           |
| ------ | ---------------------------------------------------------- |
| str  | 指向待输出 `char` 数组首元素的指针  |
| count | 最大写入字节数|
| format | 指向指定转换格式的空终止多字节字符串指针。格式字符串由零或更多个限定符和通常字符（除 `%` ）构成。所有通常字符，包括空终止字符，都会被复制到输出字符串而不加修改。每个转换限定符都始于 `%` 字符，可选地跟随 `E` 或 `O` 修饰符（若本地环境不支持则忽略），后随决定修饰符行为的字符。可用修饰符格式见 1.6 |
| time | 	指向指定待格式化时间的 struct tm 对象 |





#### 1.5. 函数返回值

成功时，返回写入 `str` 所指向的字符数组的字节数，不包含终止` '\0'` 。若在能存储整个字符串前抵达 `count` ，则返回 0 ，写入内容是未定义的。 







#### 1.6. 补充说明

| 转换 指定符 |                             解释                             |            使用的域             |
| :---------: | :----------------------------------------------------------: | :-----------------------------: |
|     `%`     |          写字面的 `%` 。完整转换指定必须是 `%%` 。           |                                 |
|  `n` (C99)  |                           写换行符                           |                                 |
|  `t` (C99)  |                         写水平制表符                         |                                 |
|     年      |                                                              |                                 |
|     `Y`     |                    以 4 位十进制数写年。                     |            `tm_year`            |
| `EY` (C99)  | 以替用方式写年。例如在 ja_JP 本地环境中，以“平成23年”取代“2011年”。 |            `tm_year`            |
|     `y`     |           写年的末 2 位十进制数（范围`[00,99]`）。           |            `tm_year`            |
| `Oy` (C99)  | 以替用数字系统写年的末 2 位数字。例如在 ja_JP 本地环境中以“十一”取代“11”。 |            `tm_year`            |
| `Ey` (C99)  | 将年写作从本地环境的替用时期 `%EC` 的偏移（本地环境依赖）。  |            `tm_year`            |
|  `C` (C99)  |          写年的首 2 位十进制数（范围 `[00,99]` ）。          |            `tm_year`            |
| `EC` (C99)  | 以本地环境的替用表示写年份基底（时期），例如 ja_JP 中的“平成”。 |            `tm_year`            |
|  `G` (C99)  | 写基于 ISO 8601 的年，即是包含指定星期的年份。IS0 8601 中星期以星期一开始，而且一年的首星期必须满足下列要求：包含 1 月 4 日包含一年的首个星期四 | `tm_year`, `tm_wday`, `tm_yday` |
|  `g` (C99)  | 写基于 ISO 8601 的年，即是包含指定星期年份，的后 2 位数（范围 `[00,99]` ）。IS0 8601 中星期以星期一开始，而且一年的首星期必须满足下列要求：包含 1 月 4 日包含一年的首个星期四 | `tm_year`, `tm_wday`, `tm_yday` |
|     月      |                                                              |                                 |
|     `b`     |          写缩略月名，例如 `Oct` （本地环境依赖）。           |            `tm_mon`             |
|  `h` (C99)  |                        与 `b` 同意。                         |            `tm_mon`             |
|     `B`     |        写完整月名，例如 `October` （本地环境依赖）。         |            `tm_mon`             |
|     `m`     |            将月写作十进制数（范围 `[01,12]` ）。             |            `tm_mon`             |
| `Om` (C99)  |  以替用数字系统写月。例如 ja_JP 本地环境中“十二”取代“12”。   |            `tm_mon`             |
|    星期     |                                                              |                                 |
|     `U`     | 以十进制数写年的星期（星期日是星期的首日）（范围 `[00,53]` ）。 | `tm_year`, `tm_wday`, `tm_yday` |
| `OU` (C99)  | 以替用数值系统写如同用 `%U` 的年的星期。例如“五十二”在 ja_JP 本地环境中取代“52”。 | `tm_year`, `tm_wday`, `tm_yday` |
|     `W`     | 以十进制数写年的星期（星期一是星期的首日）（范围 `[00,53]` ）。 | `tm_year`, `tm_wday`, `tm_yday` |
| `OW` (C99)  | 以替用数值系统写如同用 `%W` 的年的第星期。例如“五十二”在 ja_JP 本地环境中取代“52”。 | `tm_year`, `tm_wday`, `tm_yday` |
|  `V` (C99)  | 写 ISO 8601 的年的星期（范围`[00,53]`）。IS0 8601 中星期以星期一开始，而且一年的首星期必须满足下列要求：包含 1 月 4 日包含一年的首个星期四 | `tm_year`, `tm_wday`, `tm_yday` |
| `OV` (C99)  | 以替用数值系统写如同用 `%V` 的年的星期。例如“五十二”在 ja_JP 本地环境中取代“52”。 | `tm_year`, `tm_wday`, `tm_yday` |
|  年/月之日  |                                                              |                                 |
|     `j`     |        以十进制数写年的第几日（范围 `[001,366]` ）。         |            `tm_yday`            |
|     `d`     |         以十进制数写月的第几日（范围 `[01,31]` ）。          |            `tm_mday`            |
| `Od` (C99)  | 以替用数字系统写零基的月的第几日。例如 ja_JP 本地环境中“二十七”取代“ 27 ”。单字符前加空格。 |            `tm_mday`            |
|  `e` (C99)  |  以十进制数写月的第几日（范围`[01,31]`）。单数字前加空格。   |            `tm_mday`            |
| `Oe` (C99)  | 以替用数字系统写一基的月的第几日。例如 ja_JP 本地环境中“二十七”取代“27”。单字符前加空格。 |            `tm_mday`            |
|  星期之日   |                                                              |                                 |
|     `a`     |      写缩略的星期日期名，例如 `Fri` （本地环境依赖）。       |            `tm_wday`            |
|     `A`     |     写完整的星期日期名，例如 `Friday` （本地环境依赖）。     |            `tm_wday`            |
|     `w`     |  以十进制数写星期日期，其中星期日是 `0` （范围 `[0-6]` ）。  |            `tm_wday`            |
| `Ow` (C99)  | 用替用数字系统写星期日期，其中星期日是 `0` 。例如 ja_JP 本地环境中“二”取代“2”。 |            `tm_wday`            |
|  `u` (C99)  | 十进制数写星期日期，其中星期一是 `1` （ ISO 8601 格式）（范围 `[1-7]` ）。 |            `tm_wday`            |
| `Ou` (C99)  | 用替用数字系统写星期日期，其中星期一是 `1` 。例如 ja_JP 本地环境中“二”取代“2”。 |            `tm_wday`            |
| 时、分、秒  |                                                              |                                 |
|     `H`     |       以十进制数写时， 24 小时制（范围 `[00-23]` ）。        |            `tm_hour`            |
| `OH` (C99)  | 以替用数字系统写 24 小时制的时。例如 ja_JP 本地环境中“十八”取代“18”。 |            `tm_hour`            |
|     `I`     |       以十进制数写时， 12 小时制（范围 `[01,12]` ）。        |            `tm_hour`            |
| `OI` (C99)  | 以替用数字系统写 12 小时制的时。例如 ja_JP 本地环境中“六”取代“6”。 |            `tm_hour`            |
|     `M`     |             以十进制数写分（范围 `[00,59]` ）。              |            `tm_min`             |
| `OM` (C99)  | 以替用数字系统写分。例如 ja_JP 本地环境中“二十五”取代“25”。  |            `tm_min*             |
|     `S`     |             以十进制数写秒（范围 `[00,60]` ）。              |            `tm_sec`             |
| `OS` (C99)  | 以替用数字系统写秒。例如 ja_JP 本地环境中“二十四”取代“24”。  |            `tm_sec`             |
|    其他     |                                                              |                                 |
|     `c`     | 写标准日期时间字符串。例如 `Sun Oct 17 04:41:13 2010` （本地环境依赖）。 |              全部               |
| `Ec` (C99)  | 写替用日期时间字符串。例如 ja_JP 本地环境中“平成23年”取代“2011年”。 |              全部               |
|     `x`     |             写本地化的日期表示（本地环境依赖）。             |              全部               |
| `Ex` (C99)  | 写替用日期表示。例如 ja_JP 本地环境中“平成23年”取代“2011年”。 |              全部               |
|     `X`     |             写本地化的时间表示（本地环境依赖）。             |              全部               |
| `EX` (C99)  |               写替用时间表示（本地环境依赖）。               |              全部               |
|  `D` (C99)  |                    等价于 `"%m/%d/%y"`。                     |  `tm_mon`, `tm_mday, `tm_year`  |
|  `F` (C99)  |          等价于`"%Y-%m-%d"`（ ISO 8601 日期格式）。          | `tm_mon`, `tm_mday`, `tm_year`  |
|  `r` (C99)  |          写本地化的 12 小时制时间（本地环境依赖）。          |  `tm_hour`, `tm_min`, `tm_sec`  |
|  `R` (C99)  |                      等价于 `"%H:%M"`。                      |      `**tm_hour, `tm_min`       |
|  `T` (C99)  |         等价于 `"%H:%M:%S"`（ ISO 8601 时间格式）。          |  `tm_hour`, `tm_min`, `tm_sec`  |
|     `p`     |        写本地化的 `a.m.` 或 `p.m.` （本地环境依赖）。        |            `tm_hour`            |
|  `z` (C99)  | 以 ISO 8601 格式（例如 `-0430` ）写距 UTC 的偏移，或者倘若时区信息不可用则不写字符。 |           `tm_isdst`            |
|     `Z`     | 写依赖本地环境的时区名或缩写，或者若时区信息不可用则不写字符。 |           `tm_isdst`            |